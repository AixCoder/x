<%# ============================================
   é¦–é¡µè§†å›¾ - æ—¥æœ¬æ–‡å­¦åè¨€å±•ç¤ºé¡µé¢
   ============================================
   å±‚çº§ç»“æ„ï¼š
   1. åº•å±‚ï¼šå…¨å±ä¸»å†…å®¹åŒºï¼ˆåè¨€å¡ç‰‡ï¼‰
   2. ä¸Šå±‚ï¼šé¡¶éƒ¨å¯¼èˆªæ ï¼ˆç™»å½•/çŠ¶æ€ + JoinæŒ‰é’®ï¼‰
   3. ä¸Šå±‚ï¼šåº•éƒ¨æ“ä½œæ ï¼ˆæ’­æ”¾æŒ‰é’® + æ›´å¤šèœå•ï¼‰
   4. é¡¶å±‚ï¼šFlashæ¶ˆæ¯ã€æ¨¡æ€æ¡†ã€å¼¹å‡ºèœå•
%>

<%# ============================================
   ç¬¬1å±‚ï¼šå…¨å±ä¸»å†…å®¹åŒºï¼ˆåº•å±‚ï¼‰
   ============================================ %>
<div class="main-content">
  <%# åè¨€å¡ç‰‡ %>
  <div class="quote-card"
       data-controller="favorite"
       data-favorite-quote-value="<%= @quote %>"
       data-quote-id="<%= @quote_id %>">

    <%# çº¢å¿ƒæŒ‰é’® %>
    <button type="button"
            class="heart-button"
            data-favorite-target="button"
            data-action="click->favorite#toggle"
            aria-label="æ”¶è—è¿™æ¡åè¨€">
      <span class="heart-icon">ğŸ¤</span>
    </button>

    <h1 class="quote-text"><%= @quote %></h1>
    <p class="quote-subtitle">æ—¥æœ¬æ–‡å­¦åè¨€</p>
  </div>
</div>

<%# ============================================
   ç¬¬2å±‚ï¼šé¡¶éƒ¨å¯¼èˆªæ ï¼ˆå›ºå®šåœ¨é¡¶éƒ¨ï¼‰
   ============================================ %>
<div data-controller="auth-modal">
  <%# Flash æ¶ˆæ¯ %>
  <div id="flash-container">
    <% if flash[:notice] %>
      <div class="flash-message flash-notice" data-controller="flash">
        <%= flash[:notice] %>
      </div>
    <% end %>
  </div>

  <%# å¯¼èˆªæ ï¼šJoinæŒ‰é’® + ç™»å½•/æ³¨å†Œ æˆ– ç”¨æˆ·çŠ¶æ€ %>
  <%= render "shared/nav_bar" %>

  <%# ç™»å½•æ¨¡æ€æ¡† %>
  <%= render "shared/auth_modal" %>
</div>

<%# ============================================
   ç¬¬3å±‚ï¼šåº•éƒ¨æ“ä½œæ ï¼ˆå›ºå®šåœ¨åº•éƒ¨ï¼‰
   ============================================ %>
<div class="bottom-bar" data-controller="bottom-menu">
  <%# å‰å¾€æ’­æ”¾é¡µé¢æŒ‰é’® %>
  <%= link_to player_path, class: "go-to-player-btn", data: { turbo: true } do %>
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20">
      <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z" />
    </svg>
    å‰å¾€æ’­æ”¾é¡µé¢
  <% end %>

  <%# æ›´å¤šæŒ‰é’® %>
  <button type="button" class="more-btn" data-action="click->bottom-menu#open">
    ...
  </button>

  <%# åº•éƒ¨å¼¹å‡ºèœå•ï¼ˆé®ç½©å±‚ï¼‰ %>
  <div class="bottom-menu-backdrop" data-bottom-menu-target="backdrop" data-action="click->bottom-menu#close">
    <div class="bottom-menu-container" data-bottom-menu-target="menu">
      <div class="bottom-menu-handle"></div>
      <nav class="bottom-menu-nav">
        <button type="button" class="bottom-menu-item share-btn" data-action="click->bottom-menu#share">
          <span class="bottom-menu-icon">ğŸ“¤</span>
          <span class="bottom-menu-text">åˆ†äº«</span>
        </button>
        <%= link_to about_path, class: "bottom-menu-item", data: { action: "click->bottom-menu#itemClick" } do %>
          <span class="bottom-menu-icon">â„¹ï¸</span>
          <span class="bottom-menu-text">about</span>
        <% end %>
        <%= link_to favorites_path, class: "bottom-menu-item", data: { action: "click->bottom-menu#itemClick" } do %>
          <span class="bottom-menu-icon">â¤ï¸</span>
          <span class="bottom-menu-text">çº¢å¿ƒåˆ—è¡¨</span>
        <% end %>
      </nav>
    </div>
  </div>
</div>

<%# ============================================
   é¦–é¡µæ ·å¼
   ============================================
   å±‚çº§ç»“æ„ï¼š
   1. ä¸»å†…å®¹åŒºï¼ˆå…¨å±åº•å±‚ï¼‰
   2. é¡¶éƒ¨å¯¼èˆªæ ï¼ˆå›ºå®šï¼‰
   3. åº•éƒ¨æ“ä½œæ ï¼ˆå›ºå®šï¼‰
   4. å¼¹å±‚ï¼ˆFlashã€æ¨¡æ€æ¡†ã€èœå•ï¼‰
   ============================================ %>
<style>
  <%# ========== ç¬¬1å±‚ï¼šä¸»å†…å®¹åŒºï¼ˆå…¨å±ï¼‰========== %>
  .main-content {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    /* ä¸Šä¸‹ç•™å‡ºå¯¼èˆªæ å’Œåº•éƒ¨æ çš„ç©ºé—´ï¼Œå·¦å³ä½¿ç”¨ env(safe-area-inset) é€‚é…åˆ˜æµ·å± */
    padding: 80px max(1.5rem, env(safe-area-inset-right)) 100px max(1.5rem, env(safe-area-inset-left));
    z-index: 1;
    background: #FDFBF7; /* ç±³ç™½è‰²èƒŒæ™¯ï¼Œä¸ç™»å½•å¡ç‰‡ä¸€è‡´ */
    /* ç¡®ä¿å†…å®¹ä¸ä¼šè¶…å‡ºå®‰å…¨åŒºåŸŸ */
    box-sizing: border-box;
  }

  .quote-card {
    position: relative;
    max-width: 600px;
    width: 100%;
    text-align: center;
    padding: 2rem;
  }

  .heart-button {
    position: absolute;
    top: 0;
    right: 0;
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.5rem;
    transition: transform 0.2s ease;
    z-index: 10;
  }

  .heart-button:hover {
    transform: scale(1.1);
  }

  .heart-button:active {
    transform: scale(0.95);
  }

  .quote-text {
    font-family: "Noto Serif SC", serif;
    font-size: 2rem;
    font-weight: 400;
    color: #292524;
    line-height: 1.6;
    margin: 0 0 1rem;
  }

  .quote-subtitle {
    font-family: "Montserrat", sans-serif;
    font-size: 0.875rem;
    color: #a8a29e;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin: 0;
  }

  <%# ========== ç¬¬2å±‚ï¼šé¡¶éƒ¨å¯¼èˆªæ  ========== %>
  <%# Flash æ¶ˆæ¯ %>
  #flash-container {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
  }

  .flash-message {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-size: 0.875rem;
    text-align: center;
    animation: fadeInDown 0.3s ease;
  }

  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .flash-notice {
    background-color: #dcfce7;
    color: #16a34a;
    border: 1px solid #bbf7d0;
  }

  <%# å¯¼èˆªæ  %>
  .nav-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 100;
    background: linear-gradient(to bottom, rgba(255,255,255,0.95), rgba(255,255,255,0));
    pointer-events: none;
  }

  .nav-bar > * {
    pointer-events: auto;
  }

  .nav-left {
    display: flex;
    align-items: center;
  }

  .nav-right {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .nav-bar .user-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-left: auto;
  }

  .user-profile-link {
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .user-profile-link:hover {
    background: #f3f4f6;
  }

  .user-nickname {
    font-size: 0.875rem;
    color: #4b5563;
    font-weight: 500;
  }

  .nav-button {
    padding: 0.5rem 1.25rem;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    font-family: inherit;
    pointer-events: auto;
  }

  .login-button {
    background: white;
    color: #374151;
    border: 1px solid #d1d5db;
  }

  .login-button:hover {
    background: #f9fafb;
    border-color: #9ca3af;
  }

  .signup-button {
    background: #DC4C3E;
    color: white;
  }

  .signup-button:hover {
    background: #c93f32;
  }

  .logout-button {
    background: transparent;
    color: #6b7280;
    border: 1px solid #e5e7eb;
  }

  .logout-button:hover {
    background: #f3f4f6;
    color: #374151;
  }

  <%# Join æŒ‰é’®ï¼ˆåœ¨å¯¼èˆªæ å·¦ä¾§ï¼‰ %>
  .nav-join-btn {
    font-family: "Montserrat", sans-serif;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: #a8a29e;
    background: none;
    border: none;
    cursor: pointer;
    transition: color 0.2s;
    padding: 0.5rem 0;
  }

  .nav-join-btn:hover {
    color: #DC4C3E;
  }

  <%# ========== ç¬¬3å±‚ï¼šåº•éƒ¨æ“ä½œæ  ========== %>
  .bottom-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 80px;
    z-index: 40;
    pointer-events: none; <%# è®©ç‚¹å‡»ç©¿é€ %>
  }

  .bottom-bar > * {
    pointer-events: auto; <%# æ¢å¤å­å…ƒç´ ç‚¹å‡» %>
  }

  <%# å‰å¾€æ’­æ”¾é¡µé¢æŒ‰é’® %>
  .go-to-player-btn {
    position: absolute;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, #DC4C3E 0%, #ff6b6b 100%);
    color: white;
    border: none;
    border-radius: 50px;
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(220, 76, 62, 0.3);
  }

  .go-to-player-btn:hover {
    transform: translateX(-50%) scale(1.05);
    box-shadow: 0 6px 20px rgba(220, 76, 62, 0.4);
  }

  .go-to-player-btn:active {
    transform: translateX(-50%) scale(0.95);
  }

  .go-to-player-btn svg {
    flex-shrink: 0;
  }

  <%# æ›´å¤šæŒ‰é’® %>
  .more-btn {
    position: absolute;
    bottom: 1.5rem;
    right: 1.5rem;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: white;
    border: 1px solid #e5e7eb;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    font-size: 1.25rem;
    color: #6b7280;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .more-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
    color: #DC4C3E;
  }

  .more-btn:active {
    transform: scale(0.95);
  }

  <%# åº•éƒ¨å¼¹å‡ºèœå• %>
  .bottom-menu-backdrop {
    position: fixed;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(4px);
    z-index: 100;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s;
    pointer-events: auto;
  }

  .bottom-menu-backdrop.is-open {
    opacity: 1;
    visibility: visible;
  }

  .bottom-menu-container {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    border-radius: 24px 24px 0 0;
    padding: 1rem 0 2rem;
    transform: translateY(100%);
    transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 101;
    max-width: 480px;
    margin: 0 auto;
  }

  .bottom-menu-backdrop.is-open .bottom-menu-container {
    transform: translateY(0);
  }

  .bottom-menu-handle {
    width: 40px;
    height: 4px;
    background: #e5e7eb;
    border-radius: 2px;
    margin: 0 auto 1.5rem;
  }

  .bottom-menu-nav {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 0 1.5rem;
  }

  .bottom-menu-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.25rem;
    border-radius: 12px;
    text-decoration: none;
    color: #374151;
    transition: all 0.2s ease;
    font-size: 1rem;
    font-weight: 500;
  }

  .bottom-menu-item:hover {
    background: #f9fafb;
    color: #DC4C3E;
    transform: translateX(4px);
  }

  .bottom-menu-item:active {
    background: #f3f4f6;
    transform: translateX(4px) scale(0.98);
  }

  .bottom-menu-item.share-btn {
    background: none;
    border: none;
    width: 100%;
    text-align: left;
    cursor: pointer;
    font-family: inherit;
  }

  .bottom-menu-icon {
    font-size: 1.25rem;
    width: 32px;
    text-align: center;
  }

  .bottom-menu-text {
    font-family: var(--font-sans, "Montserrat", sans-serif);
  }
</style>
