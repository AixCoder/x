<%# ============================================
   首页视图 - 日本文学名言展示页面
   ============================================
%>

<% content_for :head do %>
  <%= stylesheet_link_tag "home", "data-turbo-track": "reload" %>
<% end %>
<%# ============================================
   第1层：全屏主内容区（底层）
   ============================================ %>
<main class="main-content">
  <%# 名言卡片 %>
  <article class="quote-card"
       data-controller="favorite"
       data-favorite-quote-value="<%= @quote %>"
       data-quote-id="<%= @quote_id %>">

    <%# 红心按钮 %>
    <button type="button"
            class="heart-button"
            data-favorite-target="button"
            data-action="click->favorite#toggle"
            aria-label="收藏这条名言">
      <span class="heart-icon">🤍</span>
    </button>

    <h1 class="quote-text"><%= @quote %></h1>
    <p class="quote-subtitle">日本文学名言</p>
  </article>
</main>

<%# ============================================
   第2层：顶部导航栏（固定在顶部）
   ============================================ %>
<div data-controller="auth-modal">
  <%# Flash 消息 %>
  <div id="flash-container">
    <% if flash[:notice] %>
      <div class="flash-message flash-notice" data-controller="flash">
        <%= flash[:notice] %>
      </div>
    <% end %>
  </div>

  <%# 导航栏：Join按钮 + 登录/注册 或 用户状态 %>
  <%= render "shared/nav_bar" %>

  <%# 登录模态框 %>
  <%= render "shared/auth_modal" %>
</div>

<%# ============================================
   第3层：底部操作栏（固定在底部）
   ============================================ %>
<div class="bottom-bar" data-controller="bottom-menu">

  <%= link_to "授权登录", player_path, class: "test-go-to-player-btn"%>

  <%# 前往播放页面按钮 %>
  <%= link_to player_path, class: "go-to-player-btn", data: { turbo: true } do %>
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="20" height="20">
      <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z" />
    </svg>
    前往播放页面
  <% end %>

  <%# 更多按钮 - 通过自定义事件触发独立菜单 %>
  <button type="button"
          class="more-btn"
          data-action="click->bottom-menu#open"
          data-bottom-menu-target="trigger">
    ...
  </button>
</div>

<%# ============================================
   第5层：底部弹出菜单（独立节点，body结束前）
   ============================================
   注：从 bottom-bar 中移出，避免嵌套层级问题
       通过 Stimulus 控制器与触发按钮通信
%>
<div class="bottom-menu-backdrop"
     data-controller="bottom-menu"
     data-bottom-menu-target="backdrop"
     data-action="click->bottom-menu#close">
  <div class="bottom-menu-container" data-bottom-menu-target="menu">
    <div class="bottom-menu-handle"></div>
    <nav class="bottom-menu-nav">
      <button type="button" class="bottom-menu-item share-btn" data-action="click->bottom-menu#share">
        <span class="bottom-menu-icon">📤</span>
        <span class="bottom-menu-text">分享</span>
      </button>
      <%#
         导航到 about 页面
         - turbo-action="advance": 将首页加入历史记录并缓存
         - action="click->bottom-menu#close": 先关闭菜单，然后正常跳转
       %>
      <%= link_to about_path, class: "bottom-menu-item", id: "nav-about",
            data: { "turbo-action": "advance", action: "click->bottom-menu#close" } do %>
        <span class="bottom-menu-icon">ℹ️</span>
        <span class="bottom-menu-text">about</span>
      <% end %>

      <%#
         导航到 favorites 页面
         - turbo-action="advance": 将首页加入历史记录并缓存
         - action="click->bottom-menu#close": 先关闭菜单，然后正常跳转
       %>
      <%= link_to favorites_path, class: "bottom-menu-item", id: "nav-favorites",
            data: { "turbo-action": "advance", action: "click->bottom-menu#close" } do %>
        <span class="bottom-menu-icon">❤️</span>
        <span class="bottom-menu-text">红心列表</span>
      <% end %>
    </nav>
  </div>
</div>
