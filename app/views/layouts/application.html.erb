<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "X" %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%# Turbo 缓存配置：允许缓存首页，确保返回时状态恢复 %>
    <%= turbo_page_requires_reload if controller_name == 'sessions' || controller_name == 'users' %>

    <%= yield :head %>

    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <style>
      /* 全局重置 - 防止移动端默认边距 */
      *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html, body {
        width: 100%;
        height: 100%;
        overflow-x: hidden;
      }

      /* Turbo 页面过渡动画 */
      .turbo-progress-bar {
        height: 3px;
        background: linear-gradient(to right, #DC4C3E, #ff6b6b);
      }

      /* 页面进入动画 */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* 页面切换时的淡入效果 */
      html[data-turbo-preview] body {
        opacity: 0.8;
      }

      body {
        animation: fadeIn 0.3s ease-out;
      }
    </style>
  </head>

  <body data-user-logged-in="<%= logged_in? %>" <%= "data-user-id='#{current_user.id}'".html_safe if logged_in? %>>
    <%= yield %>
  </body>
</html>
